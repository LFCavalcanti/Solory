// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  password      String?
  image         String?
  accounts      Account[]
  sessions      Session[]
  companyGroups UserToCompanyGroup[]
  companies     UserToCompany[]
  emailValidationTokens emailValidationToken[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model emailValidationToken {
  identifier  String   @id @default(cuid())
  token       String   @unique @db.Text
  createdAt   DateTime
  expiresAt   DateTime
  ActivatedAt DateTime?
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  @@unique([identifier, token])
}

model CompanyGroup {
  id              String @id @default(cuid())
  isActive        Boolean @default(true)
  name            String
  description     String
  createdAt       DateTime
  disabledAt      DateTime?
  shareSuppliers  Boolean @default(true) @db.Boolean
  shareClients    Boolean @default(true) @db.Boolean
  shareProducts   Boolean @default(true) @db.Boolean
  shareKpi        Boolean @default(true) @db.Boolean
  companies       Company[]
  users           UserToCompanyGroup[]
}

model UserToCompanyGroup {
  id             String @id @default(cuid())
  active         Boolean @default(true)
  createdAt      DateTime
  expiredAt      DateTime?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  companyGroup   CompanyGroup     @relation(fields: [companyGroupId], references: [id], onDelete: Cascade)
  companyGroupId String
  @@unique([userId, companyGroupId])
}

model Company {
  id           String @id @default(cuid())
  isActive     Boolean @default(true)
  createdAt       DateTime
  disabledAt      DateTime?
  aliasName    String
  fullName     String
  cnpj         String @db.VarChar(14)
  logo         String?
  mainCnae     String @db.VarChar(7)
  mainIssCode  String? @db.VarChar(4)
  isMei        Boolean @default(false)
  isSimplesNac Boolean @default(false)
  phone        String
  companyGroup         CompanyGroup     @relation(fields: [companyGroupId], references: [id], onDelete: Cascade)
  companyGroupId String
  users        UserToCompany[]
  adresses     CompanyAddress[]
  companyCnaeIss CompanyCnaeIss[]
  @@unique([cnpj, companyGroupId])
  @@index([isActive, companyGroupId])
  @@index([isActive, aliasName])
}

model UserToCompany {
  id        String  @id @default(cuid())
  active    Boolean @default(true)
  createdAt DateTime
  expiredAt DateTime?
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String
  @@unique([userId, companyId])
}

model CompanyAddress {
  id  String @id @default(cuid())
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String
  street String
  lotNumber String
  complement String
  locale String
  cep String @db.VarChar(8)
  state String
  cities   cities @relation(fields: [cityCode], references: [code], onDelete: Cascade)
  cityCode String
  information String @db.Text
}

model CompanyCnaeIss {
  id  String @id @default(cuid())
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String
  cnae   Cnae @relation(fields: [cnaeCode], references: [code], onDelete: Cascade)
  cnaeCode String @db.VarChar(7)
  issCode String? @db.VarChar(4)
}

model Cnae {
  code String @id @db.VarChar(7)
  descricao String @db.Text
  annex String
  rFactor Boolean
  aliquot Float
  companyCnaeIss CompanyCnaeIss[]
}

model cities {
  code String @id
  name String
  state String
  companyAdress CompanyAddress[]
}
